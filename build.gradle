plugins {
    id 'java'
    id "com.avast.gradle.docker-compose" version "0.14.0" apply false
    id "org.springframework.boot" version "2.3.6.RELEASE" apply false
    id "com.gorylenko.gradle-git-properties" version "2.2.4" apply false
}
allprojects {
    java {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
    repositories {
        maven {
            url "${mavenPublicUrl}"
            credentials {
                username "${mavenUsername}"
                password "${mavenPassword}"
            }
        }
        mavenLocal()
        mavenCentral()
    }
}

subprojects {
    subproject ->
        apply(new Action<ObjectConfigurationAction>() {
            @Override
            void execute(ObjectConfigurationAction objectConfigurationAction) {
                // 打印子项目名称
                if (!subproject.name.contains("platform")) {
//                    println subproject.name
                    objectConfigurationAction.plugin('java')
                    objectConfigurationAction.plugin('groovy')
                }
            }
        })
        apply plugin: "maven-publish"

        configurations {
            parentBom
            runtimeOnly.extendsFrom(parentBom)
            compileOnly.extendsFrom(parentBom)
            annotationProcessor.extendsFrom(parentBom)
            implementation.extendsFrom(parentBom)
        }
        configurations.all {
            // Check for updates every build
            resolutionStrategy.cacheChangingModulesFor 0, "seconds"
        }

        dependencies {
            parentBom platform('com.mflyyou:platform-bom:3.0.1-SNAPSHOT'){
                changing =true
            }
        }


        tasks.withType(Test) {
            useJUnitPlatform()
        }

        apply from: "${rootProject.projectDir}/gradle/checkstyle/checkstyle.gradle"
}